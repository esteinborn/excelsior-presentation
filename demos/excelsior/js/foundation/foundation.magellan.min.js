(function($,window){"use strict";Foundation.libs.magellan={name:"magellan",version:"4.0.0",settings:{activeClass:"active"},init:function(scope,method,options){return this.scope=scope||this.scope,Foundation.inherit(this,"data_options"),"object"==typeof method&&$.extend(!0,this.settings,method),"string"!=typeof method?(this.settings.init||(this.fixed_magellan=$("[data-magellan-expedition]"),this.set_threshold(),this.last_destination=$("[data-magellan-destination]").last(),this.events()),this.settings.init):this[method].call(this,options)},events:function(){var self=this;$(this.scope).on("arrival.fndtn.magellan","[data-magellan-arrival]",function(){var $destination=$(this),$expedition=$destination.closest("[data-magellan-expedition]"),activeClass=$expedition.attr("data-magellan-active-class")||self.settings.activeClass;$destination.closest("[data-magellan-expedition]").find("[data-magellan-arrival]").not($destination).removeClass(activeClass),$destination.addClass(activeClass)}),this.fixed_magellan.on("update-position.fndtn.magellan",function(){$(this)}).trigger("update-position"),$(window).on("resize.fndtn.magellan",function(){this.fixed_magellan.trigger("update-position")}.bind(this)).on("scroll.fndtn.magellan",function(){var windowScrollTop=$(window).scrollTop();self.fixed_magellan.each(function(){var $expedition=$(this);$expedition.data("magellan-top-offset")===undefined&&$expedition.data("magellan-top-offset",$expedition.offset().top),$expedition.data("magellan-fixed-position")===undefined&&$expedition.data("magellan-fixed-position",!1);var fixed_position=windowScrollTop+self.settings.threshold>$expedition.data("magellan-top-offset"),attr=$expedition.attr("data-magellan-top-offset");$expedition.data("magellan-fixed-position")!=fixed_position&&($expedition.data("magellan-fixed-position",fixed_position),fixed_position?$expedition.css({position:"fixed",top:0}):$expedition.css({position:"",top:""}),fixed_position&&attr!==undefined&&0!=attr&&$expedition.css({position:"fixed",top:attr+"px"}))})}),this.last_destination.length>0&&$(window).on("scroll.fndtn.magellan",function(){var windowScrollTop=$(window).scrollTop(),scrolltopPlusHeight=windowScrollTop+$(window).height(),lastDestinationTop=Math.ceil(self.last_destination.offset().top);$("[data-magellan-destination]").each(function(){var $destination=$(this),destination_name=$destination.attr("data-magellan-destination"),topOffset=$destination.offset().top-windowScrollTop;self.settings.threshold>=topOffset&&$("[data-magellan-arrival='"+destination_name+"']").trigger("arrival"),scrolltopPlusHeight>=$(self.scope).height()&&lastDestinationTop>windowScrollTop&&scrolltopPlusHeight>lastDestinationTop&&$("[data-magellan-arrival]").last().trigger("arrival")})}),this.settings.init=!0},set_threshold:function(){this.settings.threshold||(this.settings.threshold=this.fixed_magellan.length>0?this.outerHeight(this.fixed_magellan,!0):0)},off:function(){$(this.scope).off(".fndtn.magellan")}}})(Foundation.zj,this,this.document);