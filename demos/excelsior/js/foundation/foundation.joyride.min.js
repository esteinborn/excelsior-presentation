(function($,window,document,undefined){"use strict";Foundation.libs.joyride={name:"joyride",version:"4.1.2",defaults:{expose:!1,modal:!1,tipLocation:"bottom",nubPosition:"auto",scrollSpeed:300,timer:0,startTimerOnClick:!0,startOffset:0,nextButton:!0,tipAnimation:"fade",pauseAfter:[],exposed:[],tipAnimationFadeSpeed:300,cookieMonster:!1,cookieName:"joyride",cookieDomain:!1,cookieExpires:365,tipContainer:"body",postRideCallback:function(){},postStepCallback:function(){},preStepCallback:function(){},preRideCallback:function(){},postExposeCallback:function(){},template:{link:'<a href="#close" class="joyride-close-tip">&times;</a>',timer:'<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',tip:'<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>',wrapper:'<div class="joyride-content-wrapper"></div>',button:'<a href="#" class="small button joyride-next-tip"></a>',modal:'<div class="joyride-modal-bg"></div>',expose:'<div class="joyride-expose-wrapper"></div>',exposeCover:'<div class="joyride-expose-cover"></div>'},exposeAddClass:""},settings:{},init:function(scope,method,options){return this.scope=scope||this.scope,Foundation.inherit(this,"throttle data_options scrollTo scrollLeft delay"),"object"==typeof method?$.extend(!0,this.settings,this.defaults,method):$.extend(!0,this.settings,this.defaults,options),"string"!=typeof method?(this.settings.init||this.events(),this.settings.init):this[method].call(this,options)},events:function(){var self=this;$(this.scope).on("click.joyride",".joyride-next-tip, .joyride-modal-bg",function(e){e.preventDefault(),1>this.settings.$li.next().length?this.end():this.settings.timer>0?(clearTimeout(this.settings.automate),this.hide(),this.show(),this.startTimer()):(this.hide(),this.show())}.bind(this)).on("click.joyride",".joyride-close-tip",function(e){e.preventDefault(),this.end()}.bind(this)),$(window).on("resize.fndtn.joyride",self.throttle(function(){if($("[data-joyride]").length>0&&self.settings.$next_tip){if(self.settings.exposed.length>0){var $els=$(self.settings.exposed);$els.each(function(){var $this=$(this);self.un_expose($this),self.expose($this)})}self.is_phone()?self.pos_phone():self.pos_default(!1,!0)}},100)),this.settings.init=!0},start:function(){var self=this,$this=$(this.scope).find("[data-joyride]"),integer_settings=["timer","scrollSpeed","startOffset","tipAnimationFadeSpeed","cookieExpires"],int_settings_count=integer_settings.length;this.settings.init||this.init(),this.settings.$content_el=$this,this.settings.$body=$(this.settings.tipContainer),this.settings.body_offset=$(this.settings.tipContainer).position(),this.settings.$tip_content=this.settings.$content_el.find("> li"),this.settings.paused=!1,this.settings.attempts=0,this.settings.tipLocationPatterns={top:["bottom"],bottom:[],left:["right","top","bottom"],right:["left","top","bottom"]},"function"!=typeof $.cookie&&(this.settings.cookieMonster=!1),(!this.settings.cookieMonster||this.settings.cookieMonster&&null===$.cookie(this.settings.cookieName))&&(this.settings.$tip_content.each(function(index){var $this=$(this);$.extend(!0,self.settings,self.data_options($this));for(var i=int_settings_count-1;i>=0;i--)self.settings[integer_settings[i]]=parseInt(self.settings[integer_settings[i]],10);self.create({$li:$this,index:index})}),!this.settings.startTimerOnClick&&this.settings.timer>0?(this.show("init"),this.startTimer()):this.show("init"))},resume:function(){this.set_li(),this.show()},tip_template:function(opts){var $blank,content;return opts.tip_class=opts.tip_class||"",$blank=$(this.settings.template.tip).addClass(opts.tip_class),content=$.trim($(opts.li).html())+this.button_text(opts.button_text)+this.settings.template.link+this.timer_instance(opts.index),$blank.append($(this.settings.template.wrapper)),$blank.first().attr("data-index",opts.index),$(".joyride-content-wrapper",$blank).append(content),$blank[0]},timer_instance:function(index){var txt;return txt=0===index&&this.settings.startTimerOnClick&&this.settings.timer>0||0===this.settings.timer?"":this.outerHTML($(this.settings.template.timer)[0])},button_text:function(txt){return this.settings.nextButton?(txt=$.trim(txt)||"Next",txt=this.outerHTML($(this.settings.template.button).append(txt)[0])):txt="",txt},create:function(opts){var buttonText=opts.$li.attr("data-button")||opts.$li.attr("data-text"),tipClass=opts.$li.attr("class"),$tip_content=$(this.tip_template({tip_class:tipClass,index:opts.index,button_text:buttonText,li:opts.$li}));$(this.settings.tipContainer).append($tip_content)},show:function(init){var $timer=null;this.settings.$li===undefined||-1===$.inArray(this.settings.$li.index(),this.settings.pauseAfter)?(this.settings.paused?this.settings.paused=!1:this.set_li(init),this.settings.attempts=0,this.settings.$li.length&&this.settings.$target.length>0?(init&&(this.settings.preRideCallback(this.settings.$li.index(),this.settings.$next_tip),this.settings.modal&&this.show_modal()),this.settings.preStepCallback(this.settings.$li.index(),this.settings.$next_tip),this.settings.modal&&this.settings.expose&&this.expose(),this.settings.tipSettings=$.extend(this.settings,this.data_options(this.settings.$li)),this.settings.timer=parseInt(this.settings.timer,10),this.settings.tipSettings.tipLocationPattern=this.settings.tipLocationPatterns[this.settings.tipSettings.tipLocation],/body/i.test(this.settings.$target.selector)||this.scroll_to(),this.is_phone()?this.pos_phone(!0):this.pos_default(!0),$timer=this.settings.$next_tip.find(".joyride-timer-indicator"),/pop/i.test(this.settings.tipAnimation)?($timer.width(0),this.settings.timer>0?(this.settings.$next_tip.show(),this.delay(function(){$timer.animate({width:$timer.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tipAnimationFadeSpeed)):this.settings.$next_tip.show()):/fade/i.test(this.settings.tipAnimation)&&($timer.width(0),this.settings.timer>0?(this.settings.$next_tip.fadeIn(this.settings.tipAnimationFadeSpeed).show(),this.delay(function(){$timer.animate({width:$timer.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tipAnimationFadeSpeed)):this.settings.$next_tip.fadeIn(this.settings.tipAnimationFadeSpeed)),this.settings.$current_tip=this.settings.$next_tip):this.settings.$li&&1>this.settings.$target.length?this.show():this.end()):this.settings.paused=!0},is_phone:function(){return Modernizr?Modernizr.mq("only screen and (max-width: 767px)")||$(".lt-ie9").length>0:767>this.settings.$window.width()},hide:function(){this.settings.modal&&this.settings.expose&&this.un_expose(),this.settings.modal||$(".joyride-modal-bg").hide(),this.settings.$current_tip.hide(),this.settings.postStepCallback(this.settings.$li.index(),this.settings.$current_tip)},set_li:function(init){init?(this.settings.$li=this.settings.$tip_content.eq(this.settings.startOffset),this.set_next_tip(),this.settings.$current_tip=this.settings.$next_tip):(this.settings.$li=this.settings.$li.next(),this.set_next_tip()),this.set_target()},set_next_tip:function(){this.settings.$next_tip=$(".joyride-tip-guide[data-index='"+this.settings.$li.index()+"']"),this.settings.$next_tip.data("closed","")},set_target:function(){var cl=this.settings.$li.attr("data-class"),id=this.settings.$li.attr("data-id"),$sel=function(){return id?$(document.getElementById(id)):cl?$("."+cl).first():$("body")};this.settings.$target=$sel()},scroll_to:function(){var window_half,tipOffset;window_half=$(window).height()/2,tipOffset=Math.ceil(this.settings.$target.offset().top-window_half+this.outerHeight(this.settings.$next_tip)),tipOffset>0&&this.scrollTo($("html, body"),tipOffset,this.settings.scrollSpeed)},paused:function(){return-1===$.inArray(this.settings.$li.index()+1,this.settings.pauseAfter)},restart:function(){this.hide(),this.settings.$li=undefined,this.show("init")},pos_default:function(init,resizing){var $nub=(Math.ceil($(window).height()/2),this.settings.$next_tip.offset(),this.settings.$next_tip.find(".joyride-nub")),nub_width=Math.ceil(this.outerWidth($nub)/2),nub_height=Math.ceil(this.outerHeight($nub)/2),toggle=init||!1;if(toggle&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),resizing===undefined&&(resizing=!1),/body/i.test(this.settings.$target.selector))this.settings.$li.length&&this.pos_modal($nub);else{if(this.bottom()){var leftOffset=this.settings.$target.offset().left;Foundation.rtl&&(leftOffset=this.settings.$target.offset().width-this.settings.$next_tip.width()+leftOffset),this.settings.$next_tip.css({top:this.settings.$target.offset().top+nub_height+this.outerHeight(this.settings.$target),left:leftOffset}),this.nub_position($nub,this.settings.tipSettings.nubPosition,"top")}else if(this.top()){var leftOffset=this.settings.$target.offset().left;Foundation.rtl&&(leftOffset=this.settings.$target.offset().width-this.settings.$next_tip.width()+leftOffset),this.settings.$next_tip.css({top:this.settings.$target.offset().top-this.outerHeight(this.settings.$next_tip)-nub_height,left:leftOffset}),this.nub_position($nub,this.settings.tipSettings.nubPosition,"bottom")}else this.right()?(this.settings.$next_tip.css({top:this.settings.$target.offset().top,left:this.outerWidth(this.settings.$target)+this.settings.$target.offset().left+nub_width}),this.nub_position($nub,this.settings.tipSettings.nubPosition,"left")):this.left()&&(this.settings.$next_tip.css({top:this.settings.$target.offset().top,left:this.settings.$target.offset().left-this.outerWidth(this.settings.$next_tip)-nub_width}),this.nub_position($nub,this.settings.tipSettings.nubPosition,"right"));!this.visible(this.corners(this.settings.$next_tip))&&this.settings.attempts<this.settings.tipSettings.tipLocationPattern.length&&($nub.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),this.settings.tipSettings.tipLocation=this.settings.tipSettings.tipLocationPattern[this.settings.attempts],this.settings.attempts++,this.pos_default())}toggle&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_phone:function(init){var tip_height=this.outerHeight(this.settings.$next_tip),target_height=(this.settings.$next_tip.offset(),this.outerHeight(this.settings.$target)),$nub=$(".joyride-nub",this.settings.$next_tip),nub_height=Math.ceil(this.outerHeight($nub)/2),toggle=init||!1;$nub.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),toggle&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),/body/i.test(this.settings.$target.selector)?this.settings.$li.length&&this.pos_modal($nub):this.top()?(this.settings.$next_tip.offset({top:this.settings.$target.offset().top-tip_height-nub_height}),$nub.addClass("bottom")):(this.settings.$next_tip.offset({top:this.settings.$target.offset().top+target_height+nub_height}),$nub.addClass("top")),toggle&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_modal:function($nub){this.center(),$nub.hide(),this.show_modal()},show_modal:function(){if(!this.settings.$next_tip.data("closed")){var joyridemodalbg=$(".joyride-modal-bg");1>joyridemodalbg.length&&$("body").append(this.settings.template.modal).show(),/pop/i.test(this.settings.tipAnimation)?joyridemodalbg.show():joyridemodalbg.fadeIn(this.settings.tipAnimationFadeSpeed)}},expose:function(){var expose,exposeCover,el,origCSS,origClasses,randId="expose-"+Math.floor(1e4*Math.random());if(arguments.length>0&&arguments[0]instanceof $)el=arguments[0];else{if(!this.settings.$target||/body/i.test(this.settings.$target.selector))return!1;el=this.settings.$target}return 1>el.length?(window.console&&console.error("element not valid",el),!1):(expose=$(this.settings.template.expose),this.settings.$body.append(expose),expose.css({top:el.offset().top,left:el.offset().left,width:this.outerWidth(el,!0),height:this.outerHeight(el,!0)}),exposeCover=$(this.settings.template.exposeCover),origCSS={zIndex:el.css("z-index"),position:el.css("position")},origClasses=null==el.attr("class")?"":el.attr("class"),el.css("z-index",parseInt(expose.css("z-index"))+1),"static"==origCSS.position&&el.css("position","relative"),el.data("expose-css",origCSS),el.data("orig-class",origClasses),el.attr("class",origClasses+" "+this.settings.exposeAddClass),exposeCover.css({top:el.offset().top,left:el.offset().left,width:this.outerWidth(el,!0),height:this.outerHeight(el,!0)}),this.settings.$body.append(exposeCover),expose.addClass(randId),exposeCover.addClass(randId),el.data("expose",randId),this.settings.postExposeCallback(this.settings.$li.index(),this.settings.$next_tip,el),this.add_exposed(el),undefined)},un_expose:function(){var exposeId,el,expose,origCSS,origClasses,clearAll=!1;if(arguments.length>0&&arguments[0]instanceof $)el=arguments[0];else{if(!this.settings.$target||/body/i.test(this.settings.$target.selector))return!1;el=this.settings.$target}return 1>el.length?(window.console&&console.error("element not valid",el),!1):(exposeId=el.data("expose"),expose=$("."+exposeId),arguments.length>1&&(clearAll=arguments[1]),clearAll===!0?$(".joyride-expose-wrapper,.joyride-expose-cover").remove():expose.remove(),origCSS=el.data("expose-css"),"auto"==origCSS.zIndex?el.css("z-index",""):el.css("z-index",origCSS.zIndex),origCSS.position!=el.css("position")&&("static"==origCSS.position?el.css("position",""):el.css("position",origCSS.position)),origClasses=el.data("orig-class"),el.attr("class",origClasses),el.removeData("orig-classes"),el.removeData("expose"),el.removeData("expose-z-index"),this.remove_exposed(el),undefined)},add_exposed:function(el){this.settings.exposed=this.settings.exposed||[],el instanceof $||"object"==typeof el?this.settings.exposed.push(el[0]):"string"==typeof el&&this.settings.exposed.push(el)},remove_exposed:function(el){var search,count;el instanceof $?search=el[0]:"string"==typeof el&&(search=el),this.settings.exposed=this.settings.exposed||[],count=this.settings.exposed.length;for(var i=0;count>i;i++)if(this.settings.exposed[i]==search)return this.settings.exposed.splice(i,1),undefined},center:function(){var $w=$(window);return this.settings.$next_tip.css({top:($w.height()-this.outerHeight(this.settings.$next_tip))/2+$w.scrollTop(),left:($w.width()-this.outerWidth(this.settings.$next_tip))/2+this.scrollLeft($w)}),!0},bottom:function(){return/bottom/i.test(this.settings.tipSettings.tipLocation)},top:function(){return/top/i.test(this.settings.tipSettings.tipLocation)},right:function(){return/right/i.test(this.settings.tipSettings.tipLocation)},left:function(){return/left/i.test(this.settings.tipSettings.tipLocation)},corners:function(el){var w=$(window),window_half=w.height()/2,tipOffset=Math.ceil(this.settings.$target.offset().top-window_half+this.settings.$next_tip.outerHeight()),right=w.width()+this.scrollLeft(w),offsetBottom=w.height()+tipOffset,bottom=w.height()+w.scrollTop(),top=w.scrollTop();return top>tipOffset&&(top=0>tipOffset?0:tipOffset),offsetBottom>bottom&&(bottom=offsetBottom),[top>el.offset().top,el.offset().left+el.outerWidth()>right,el.offset().top+el.outerHeight()>bottom,this.scrollLeft(w)>el.offset().left]},visible:function(hidden_corners){for(var i=hidden_corners.length;i--;)if(hidden_corners[i])return!1;return!0},nub_position:function(nub,pos,def){"auto"===pos?nub.addClass(def):nub.addClass(pos)},startTimer:function(){this.settings.$li.length?this.settings.automate=setTimeout(function(){this.hide(),this.show(),this.startTimer()}.bind(this),this.settings.timer):clearTimeout(this.settings.automate)},end:function(){this.settings.cookieMonster&&$.cookie(this.settings.cookieName,"ridden",{expires:this.settings.cookieExpires,domain:this.settings.cookieDomain}),this.settings.timer>0&&clearTimeout(this.settings.automate),this.settings.modal&&this.settings.expose&&this.un_expose(),this.settings.$next_tip.data("closed",!0),$(".joyride-modal-bg").hide(),this.settings.$current_tip.hide(),this.settings.postStepCallback(this.settings.$li.index(),this.settings.$current_tip),this.settings.postRideCallback(this.settings.$li.index(),this.settings.$current_tip),$(".joyride-tip-guide").remove()},outerHTML:function(el){return el.outerHTML||(new XMLSerializer).serializeToString(el)},off:function(){$(this.scope).off(".joyride"),$(window).off(".joyride"),$(".joyride-close-tip, .joyride-next-tip, .joyride-modal-bg").off(".joyride"),$(".joyride-tip-guide, .joyride-modal-bg").remove(),clearTimeout(this.settings.automate),this.settings={}}}})(Foundation.zj,this,this.document);