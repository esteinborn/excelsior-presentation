(function($,window,document,undefined){"use strict";Foundation.libs.forms={name:"forms",version:"4.1.6",cache:{},settings:{disable_class:"no-custom",last_combo:null},init:function(scope,method,options){return"object"==typeof method&&$.extend(!0,this.settings,method),"string"!=typeof method?(this.settings.init||this.events(),this.assemble(),this.settings.init):this[method].call(this,options)},assemble:function(){$('form.custom input[type="radio"]',$(this.scope)).not('[data-customforms="disabled"]').each(this.append_custom_markup),$('form.custom input[type="checkbox"]',$(this.scope)).not('[data-customforms="disabled"]').each(this.append_custom_markup),$("form.custom select",$(this.scope)).not('[data-customforms="disabled"]').not("[multiple=multiple]").each(this.append_custom_select)},events:function(){var self=this;$(this.scope).on("click.fndtn.forms","form.custom span.custom.checkbox",function(e){e.preventDefault(),e.stopPropagation(),self.toggle_checkbox($(this))}).on("click.fndtn.forms","form.custom span.custom.radio",function(e){e.preventDefault(),e.stopPropagation(),self.toggle_radio($(this))}).on("change.fndtn.forms",'form.custom select:not([data-customforms="disabled"])',function(e,force_refresh){self.refresh_custom_select($(this),force_refresh)}).on("click.fndtn.forms","form.custom label",function(e){if($(e.target).is("label")){var $customCheckbox,$customRadio,$associatedElement=$("#"+self.escape($(this).attr("for"))+':not([data-customforms="disabled"])');0!==$associatedElement.length&&("checkbox"===$associatedElement.attr("type")?(e.preventDefault(),$customCheckbox=$(this).find("span.custom.checkbox"),0==$customCheckbox.length&&($customCheckbox=$associatedElement.add(this).siblings("span.custom.checkbox").first()),self.toggle_checkbox($customCheckbox)):"radio"===$associatedElement.attr("type")&&(e.preventDefault(),$customRadio=$(this).find("span.custom.radio"),0==$customRadio.length&&($customRadio=$associatedElement.add(this).siblings("span.custom.radio").first()),self.toggle_radio($customRadio)))}}).on("mousedown.fndtn.forms","form.custom div.custom.dropdown",function(){return!1}).on("click.fndtn.forms","form.custom div.custom.dropdown a.current, form.custom div.custom.dropdown a.selector",function(e){var $this=$(this),$dropdown=$this.closest("div.custom.dropdown"),$select=getFirstPrevSibling($dropdown,"select");return $dropdown.hasClass("open")||$(self.scope).trigger("click"),e.preventDefault(),!1===$select.is(":disabled")?($dropdown.toggleClass("open"),$dropdown.hasClass("open")?$(self.scope).on("click.fndtn.forms.customdropdown",function(){$dropdown.removeClass("open"),$(self.scope).off(".fndtn.forms.customdropdown")}):$(self.scope).on(".fndtn.forms.customdropdown"),!1):undefined}).on("click.fndtn.forms touchend.fndtn.forms","form.custom div.custom.dropdown li",function(e){var $this=$(this),$customDropdown=$this.closest("div.custom.dropdown"),$select=getFirstPrevSibling($customDropdown,"select"),selectedIndex=0;if(e.preventDefault(),e.stopPropagation(),!$(this).hasClass("disabled")){$("div.dropdown").not($customDropdown).removeClass("open");var $oldThis=$this.closest("ul").find("li.selected");$oldThis.removeClass("selected"),$this.addClass("selected"),$customDropdown.removeClass("open").find("a.current").text($this.text()),$this.closest("ul").find("li").each(function(index){$this[0]==this&&(selectedIndex=index)}),$select[0].selectedIndex=selectedIndex,$select.data("prevalue",$oldThis.html()),$select.trigger("change")}}),$(window).on("keydown",function(e){var self=(document.activeElement,Foundation.libs.forms),dropdown=$(".custom.dropdown.open");if(dropdown.length>0){if(e.preventDefault(),13===e.which&&dropdown.find("li.selected").trigger("click"),27===e.which&&dropdown.removeClass("open"),e.which>=65&&90>=e.which){var next=self.go_to(dropdown,e.which),current=dropdown.find("li.selected");next&&(current.removeClass("selected"),self.scrollTo(next.addClass("selected"),300))}if(38===e.which){var current=dropdown.find("li.selected"),prev=current.prev(":not(.disabled)");prev.length>0&&(prev.parent()[0].scrollTop=prev.parent().scrollTop()-self.outerHeight(prev),current.removeClass("selected"),prev.addClass("selected"))}else if(40===e.which){var current=dropdown.find("li.selected"),next=current.next(":not(.disabled)");next.length>0&&(next.parent()[0].scrollTop=next.parent().scrollTop()+self.outerHeight(next),current.removeClass("selected"),next.addClass("selected"))}}}),this.settings.init=!0},go_to:function(dropdown,character){var lis=dropdown.find("li"),count=lis.length;if(count>0)for(var i=0;count>i;i++){var first_letter=lis.eq(i).text().charAt(0).toLowerCase();if(first_letter===String.fromCharCode(character).toLowerCase())return lis.eq(i)}},scrollTo:function(el,duration){if(!(0>duration)){var parent=el.parent(),li_height=this.outerHeight(el),difference=li_height*el.index()-parent.scrollTop(),perTick=10*(difference/duration);this.scrollToTimerCache=setTimeout(function(){isNaN(parseInt(perTick,10))||(parent[0].scrollTop=parent.scrollTop()+perTick,this.scrollTo(el,duration-10))}.bind(this),10)}},append_custom_markup:function(idx,sel){var $this=$(sel),type=$this.attr("type"),$span=$this.next("span.custom."+type);$this.parent().hasClass("switch")||$this.addClass("hidden-field"),0===$span.length&&($span=$('<span class="custom '+type+'"></span>').insertAfter($this)),$span.toggleClass("checked",$this.is(":checked")),$span.toggleClass("disabled",$this.is(":disabled"))},append_custom_select:function(idx,sel){var $listItems,self=Foundation.libs.forms,$this=$(sel),$customSelect=$this.next("div.custom.dropdown"),$customList=$customSelect.find("ul"),$selector=($customSelect.find(".current"),$customSelect.find(".selector")),$options=$this.find("option"),$selectedOption=$options.filter(":selected"),copyClasses=$this.attr("class")?$this.attr("class").split(" "):[],maxWidth=0,liHtml="",$currentSelect=!1;if(!$this.hasClass(self.settings.disable_class)){if(0===$customSelect.length){var customSelectSize=$this.hasClass("small")?"small":$this.hasClass("medium")?"medium":$this.hasClass("large")?"large":$this.hasClass("expand")?"expand":"";$customSelect=$('<div class="'+["custom","dropdown",customSelectSize].concat(copyClasses).filter(function(item,idx,arr){return""==item?!1:arr.indexOf(item)==idx}).join(" ")+'"><a href="#" class="selector"></a><ul /></div>'),$selector=$customSelect.find(".selector"),$customList=$customSelect.find("ul"),liHtml=$options.map(function(){return"<li>"+$(this).html()+"</li>"}).get().join(""),$customList.append(liHtml),$currentSelect=$customSelect.prepend('<a href="#" class="current">'+$selectedOption.html()+"</a>").find(".current"),$this.after($customSelect).addClass("hidden-field")}else liHtml=$options.map(function(){return"<li>"+$(this).html()+"</li>"}).get().join(""),$customList.html("").append(liHtml);if(self.assign_id($this,$customSelect),$customSelect.toggleClass("disabled",$this.is(":disabled")),$listItems=$customList.find("li"),self.cache[$customSelect.data("id")]=$listItems.length,$options.each(function(index){this.selected&&($listItems.eq(index).addClass("selected"),$currentSelect&&$currentSelect.html($(this).html())),$(this).is(":disabled")&&$listItems.eq(index).addClass("disabled")}),!$customSelect.is(".small, .medium, .large, .expand")){$customSelect.addClass("open");var self=Foundation.libs.forms;self.hidden_fix.adjust($customList),maxWidth=self.outerWidth($listItems)>maxWidth?self.outerWidth($listItems):maxWidth,Foundation.libs.forms.hidden_fix.reset(),$customSelect.removeClass("open")}}},assign_id:function($select,$customSelect){var id=[+new Date,Foundation.random_str(5)].join("-");$select.attr("data-id",id),$customSelect.attr("data-id",id)},refresh_custom_select:function($select,force_refresh){var self=this,maxWidth=0,$customSelect=$select.next(),$options=$select.find("option"),$listItems=$customSelect.find("li");($listItems.length!=this.cache[$customSelect.data("id")]||force_refresh)&&($customSelect.find("ul").html(""),$options.each(function(){var $li=$("<li>"+$(this).html()+"</li>");$customSelect.find("ul").append($li)}),$options.each(function(index){this.selected&&($customSelect.find("li").eq(index).addClass("selected"),$customSelect.find(".current").html($(this).html())),$(this).is(":disabled")&&$customSelect.find("li").eq(index).addClass("disabled")}),$customSelect.removeAttr("style").find("ul").removeAttr("style"),$customSelect.find("li").each(function(){$customSelect.addClass("open"),self.outerWidth($(this))>maxWidth&&(maxWidth=self.outerWidth($(this))),$customSelect.removeClass("open")}),$listItems=$customSelect.find("li"),this.cache[$customSelect.data("id")]=$listItems.length)},toggle_checkbox:function($element){var $input=$element.prev(),input=$input[0];!1===$input.is(":disabled")&&(input.checked=input.checked?!1:!0,$element.toggleClass("checked"),$input.trigger("change"))},toggle_radio:function($element){var $input=$element.prev(),$form=$input.closest("form.custom"),input=$input[0];!1===$input.is(":disabled")&&($form.find('input[type="radio"][name="'+this.escape($input.attr("name"))+'"]').next().not($element).removeClass("checked"),$element.hasClass("checked")||$element.toggleClass("checked"),input.checked=$element.hasClass("checked"),$input.trigger("change"))},escape:function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},hidden_fix:{tmp:[],hidden:null,adjust:function($child){var _self=this;_self.hidden=$child.parents().andSelf().filter(":hidden"),_self.hidden.each(function(){var $elem=$(this);_self.tmp.push($elem.attr("style")),$elem.css({visibility:"hidden",display:"block"})})},reset:function(){var _self=this;_self.hidden.each(function(i){var $elem=$(this),_tmp=_self.tmp[i];_tmp===undefined?$elem.removeAttr("style"):$elem.attr("style",_tmp)}),_self.tmp=[],_self.hidden=null}},off:function(){$(this.scope).off(".fndtn.forms")}};var getFirstPrevSibling=function($el,selector){for(var $el=$el.prev();$el.length;){if($el.is(selector))return $el;$el=$el.prev()}return $()}})(Foundation.zj,this,this.document);